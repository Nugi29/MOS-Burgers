<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOS Burgers - Reports</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark" id="navbar">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-hamburger text-warning me-2"></i> MOS Burgers
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="menu.html">Menu</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="order.html">Orders</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Inventory.html">Inventory</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="customers.html">Customers</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="reports.html">Reports</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
        <h1 class="mb-4">Business Reports</h1>
        <p id="reportDateTime" class="text-muted mb-4"></p>

        <!-- Report Selection Tabs -->
        <ul class="nav nav-pills mb-4" id="reportTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="daily-tab" data-bs-toggle="pill" data-bs-target="#daily"
                    type="button" role="tab">Daily Report</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="monthly-tab" data-bs-toggle="pill" data-bs-target="#monthly" type="button"
                    role="tab">Monthly Report</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="annual-tab" data-bs-toggle="pill" data-bs-target="#annual" type="button"
                    role="tab">Annual Report</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="item-tab" data-bs-toggle="pill" data-bs-target="#item" type="button"
                    role="tab">Item Analysis</button>
            </li>
        </ul>

        <!-- Report Filters -->
        <div class="card mb-4 bg-light">
            <div class="card-body">
                <h5 class="card-title">Report Filters</h5>
                <div class="row g-3">
                    <div class="col-md-4">
                        <label for="dateRange" class="form-label">Time Period</label>
                        <select class="form-select" id="dateRange">
                            <option value="today">Today</option>
                            <option value="yesterday">Yesterday</option>
                            <option value="lastWeek">Last 7 Days</option>
                            <option value="lastMonth">Last 30 Days</option>
                            <option value="custom">Custom Range</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="categoryFilter" class="form-label">Category</label>
                        <select class="form-select" id="categoryFilter">
                            <option value="all">All Categories</option>
                            <option value="burgers">Burgers</option>
                            <option value="sides">Sides</option>
                            <option value="beverages">Beverages</option>
                            <option value="desserts">Desserts</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="locationFilter" class="form-label">Location</label>
                        <select class="form-select" id="locationFilter">
                            <option value="all">All Locations</option>
                            <option value="main">Main Branch</option>
                            <option value="downtown">Downtown</option>
                            <option value="mall">Shopping Mall</option>
                        </select>
                    </div>
                    <div class="col-12 mt-3">
                        <button type="button" class="btn btn-primary" id="applyFilters">Apply Filters</button>
                        <button type="button" class="btn btn-outline-secondary" id="resetFilters">Reset</button>
                        <button type="button" class="btn btn-success float-end" id="generatePDFButton">
                            <i class="fas fa-file-pdf me-1"></i> Generate PDF
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content -->
        <div class="tab-content" id="reportTabsContent">
            <!-- Daily Report Tab -->
            <div class="tab-pane fade show active" id="daily" role="tabpanel">
                <div class="row">
                    <!-- Daily Sales Summary -->
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <h5 class="card-title">Total Sales</h5>
                                <h2 class="card-text text-primary">Rs. 42,550</h2>
                                <p class="card-text text-success"><i class="fas fa-arrow-up"></i> 12% from yesterday</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <h5 class="card-title">Total Orders</h5>
                                <h2 class="card-text text-primary">78</h2>
                                <p class="card-text text-success"><i class="fas fa-arrow-up"></i> 8% from yesterday</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <h5 class="card-title">Avg. Order Value</h5>
                                <h2 class="card-text text-primary">Rs. 545</h2>
                                <p class="card-text text-success"><i class="fas fa-arrow-up"></i> 3% from yesterday</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <h5 class="card-title">New Customers</h5>
                                <h2 class="card-text text-primary">12</h2>
                                <p class="card-text text-danger"><i class="fas fa-arrow-down"></i> 5% from yesterday</p>
                            </div>
                        </div>
                    </div>

                    <!-- Daily Sales Chart -->
                    <div class="col-lg-8 mb-4">
                        <div class="card shadow-sm h-100">
                            <div class="card-body">
                                <h5 class="card-title">Hourly Sales Distribution</h5>
                                <div style="height: 300px">
                                    <canvas id="dailySalesChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Daily Item Distribution -->
                    <div class="col-lg-4 mb-4">
                        <div class="card shadow-sm h-100">
                            <div class="card-body">
                                <h5 class="card-title">Item Category Distribution</h5>
                                <div style="height: 300px">
                                    <canvas id="dailyCategoryChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Customers & Transactions Tables -->
                    <div class="col-md-6 mb-4">
                        <div class="card shadow-sm">
                            <div class="card-header bg-light">
                                <h5 class="card-title m-0">Customers with Most Orders</h5>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0" id="customerTable">
                                        <thead>
                                            <tr>
                                                <th>Customer Name</th>
                                                <th>Order Count</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Data will be populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-4">
                        <div class="card shadow-sm">
                            <div class="card-header bg-light">
                                <h5 class="card-title m-0">Most Popular Items for the Day</h5>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0" id="itemTable">
                                        <thead>
                                            <tr>
                                                <th>Item Name</th>
                                                <th>Quantity Sold</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Data will be populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Transaction History Table -->
                    <div class="col-12 mb-4">
                        <div class="card shadow-sm">
                            <div class="card-header bg-light">
                                <h5 class="card-title m-0">Transaction History for Today</h5>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0" id="transactionTable">
                                        <thead>
                                            <tr>
                                                <th>Customer</th>
                                                <th>Items</th>
                                                <th>Total</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Data will be populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Monthly Report Tab -->
            <div class="tab-pane fade" id="monthly" role="tabpanel">
                <div class="row">
                    <!-- Monthly Summary Cards -->
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <h5 class="card-title">Monthly Revenue</h5>
                                <h2 class="card-text text-primary">Rs. 1,245,780</h2>
                                <p class="card-text text-success"><i class="fas fa-arrow-up"></i> 15% from last month
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <h5 class="card-title">Total Orders</h5>
                                <h2 class="card-text text-primary">2,354</h2>
                                <p class="card-text text-success"><i class="fas fa-arrow-up"></i> 12% from last month
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <h5 class="card-title">Repeat Customers</h5>
                                <h2 class="card-text text-primary">68%</h2>
                                <p class="card-text text-success"><i class="fas fa-arrow-up"></i> 5% from last month</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <h5 class="card-title">Most Popular Item</h5>
                                <h2 class="card-text text-primary">Cheese Burger</h2>
                                <p class="card-text">1,245 sold this month</p>
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Sales Trend -->
                    <div class="col-12 mb-4">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">Monthly Sales Trend</h5>
                                <div style="height: 300px">
                                    <canvas id="monthlySalesChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Top Items & Top Customers -->
                    <div class="col-md-6 mb-4">
                        <div class="card shadow-sm">
                            <div class="card-header bg-light">
                                <h5 class="card-title m-0">Top Selling Items</h5>
                            </div>
                            <div class="card-body">
                                <div style="height: 300px">
                                    <canvas id="topItemsChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-4">
                        <div class="card shadow-sm">
                            <div class="card-header bg-light">
                                <h5 class="card-title m-0">Top Customers</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Customer</th>
                                                <th>Orders</th>
                                                <th>Total Spent</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Rajith Fernando</td>
                                                <td>42</td>
                                                <td>Rs. 32,450</td>
                                            </tr>
                                            <tr>
                                                <td>Chamara Perera</td>
                                                <td>36</td>
                                                <td>Rs. 28,790</td>
                                            </tr>
                                            <tr>
                                                <td>Priyanka Silva</td>
                                                <td>31</td>
                                                <td>Rs. 25,340</td>
                                            </tr>
                                            <tr>
                                                <td>Dinesh Kumar</td>
                                                <td>29</td>
                                                <td>Rs. 22,150</td>
                                            </tr>
                                            <tr>
                                                <td>Niluka Rathnayake</td>
                                                <td>27</td>
                                                <td>Rs. 20,780</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Annual Report Tab -->
            <div class="tab-pane fade" id="annual" role="tabpanel">
                <div class="row">
                    <!-- Annual Summary -->
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <h5 class="card-title">Annual Revenue</h5>
                                <h2 class="card-text text-primary">Rs. 14,568,920</h2>
                                <p class="card-text text-success"><i class="fas fa-arrow-up"></i> 22% from last year</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <h5 class="card-title">Profit Margin</h5>
                                <h2 class="card-text text-primary">24.5%</h2>
                                <p class="card-text text-success"><i class="fas fa-arrow-up"></i> 3.2% from last year
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <h5 class="card-title">Total Customers</h5>
                                <h2 class="card-text text-primary">8,452</h2>
                                <p class="card-text text-success"><i class="fas fa-arrow-up"></i> 18% from last year</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <h5 class="card-title">Total Orders</h5>
                                <h2 class="card-text text-primary">28,745</h2>
                                <p class="card-text text-success"><i class="fas fa-arrow-up"></i> 24% from last year</p>
                            </div>
                        </div>
                    </div>

                    <!-- Annual Sales Chart -->
                    <div class="col-12 mb-4">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">Annual Sales Trend</h5>
                                <div style="height: 300px">
                                    <canvas id="annualSalesChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quarterly & Category Comparison -->
                    <div class="col-md-6 mb-4">
                        <div class="card shadow-sm">
                            <div class="card-header bg-light">
                                <h5 class="card-title m-0">Quarterly Comparison</h5>
                            </div>
                            <div class="card-body">
                                <div style="height: 300px">
                                    <canvas id="quarterlyComparisonChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-4">
                        <div class="card shadow-sm">
                            <div class="card-header bg-light">
                                <h5 class="card-title m-0">Annual Category Sales</h5>
                            </div>
                            <div class="card-body">
                                <div style="height: 300px">
                                    <canvas id="categorySalesChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Item Analysis Tab -->
            <div class="tab-pane fade" id="item" role="tabpanel">
                <div class="row">
                    <!-- Item Performance Summary -->
                    <div class="col-lg-8 mb-4">
                        <div class="card shadow-sm">
                            <div class="card-header bg-light">
                                <h5 class="card-title m-0">Item Sales Ranking</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Rank</th>
                                                <th>Item Name</th>
                                                <th>Category</th>
                                                <th>Units Sold</th>
                                                <th>Revenue</th>
                                                <th>Profit Margin</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>1</td>
                                                <td>Classic Cheeseburger</td>
                                                <td>Burgers</td>
                                                <td>12,450</td>
                                                <td>Rs. 2,490,000</td>
                                                <td>32%</td>
                                            </tr>
                                            <tr>
                                                <td>2</td>
                                                <td>Spicy Chicken Burger</td>
                                                <td>Burgers</td>
                                                <td>10,280</td>
                                                <td>Rs. 2,056,000</td>
                                                <td>28%</td>
                                            </tr>
                                            <tr>
                                                <td>3</td>
                                                <td>French Fries (Large)</td>
                                                <td>Sides</td>
                                                <td>9,850</td>
                                                <td>Rs. 985,000</td>
                                                <td>45%</td>
                                            </tr>
                                            <tr>
                                                <td>4</td>
                                                <td>Chocolate Milkshake</td>
                                                <td>Beverages</td>
                                                <td>8,740</td>
                                                <td>Rs. 1,311,000</td>
                                                <td>52%</td>
                                            </tr>
                                            <tr>
                                                <td>5</td>
                                                <td>Double Beef Burger</td>
                                                <td>Burgers</td>
                                                <td>7,650</td>
                                                <td>Rs. 1,912,500</td>
                                                <td>25%</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4 mb-4">
                        <div class="card shadow-sm">
                            <div class="card-header bg-light">
                                <h5 class="card-title m-0">Category Distribution</h5>
                            </div>
                            <div class="card-body">
                                <div style="height: 300px">
                                    <canvas id="categoryDistributionChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Item Trend Analysis -->
                    <div class="col-12 mb-4">
                        <div class="card shadow-sm">
                            <div class="card-header bg-light">
                                <h5 class="card-title m-0">Top 5 Items - Monthly Trend</h5>
                            </div>
                            <div class="card-body">
                                <div style="height: 300px">
                                    <canvas id="itemTrendChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-3 mt-5">
        <div class="container">
            <p class="mb-0">Â© 2025 MOS Burgers. All Rights Reserved.</p>
            <p class="mb-0">Tasty burgers, happy customers!</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const rawData = sessionStorage.getItem('orders');
            console.log('Raw data from sessionStorage:', rawData);

            let orders = [];
            try {
                orders = JSON.parse(rawData) || [];
                console.log('Parsed orders:', orders);
            } catch (error) {
                console.error('Error parsing orders:', error);
                orders = [];
            }

            if (!Array.isArray(orders) || orders.length === 0) {
                console.log('No orders found or orders is not an array');
                displayNoDataMessage();
                // Loading sample data for demonstration
                loadSampleData();
                return;
            }

            const reportDateTime = document.getElementById('reportDateTime');
            const currentDateTime = new Date().toLocaleString();
            reportDateTime.innerText = `Report generated on: ${currentDateTime}`;

            const today = new Date();
            const todayString = today.toISOString().split('T')[0];

            console.log('Today\'s date for comparison:', todayString);

            processAndDisplayData(orders, todayString);
            initializeCharts();
        });

        function loadSampleData() {
            // Sample data for demonstration
            const sampleOrders = [
                {
                    customerName: "Rajith Fernando",
                    items: [
                        { name: "Classic Cheeseburger", quantity: 2 },
                        { name: "French Fries", quantity: 1 },
                        { name: "Cola", quantity: 2 }
                    ],
                    totalPrice: 1250
                },
                {
                    customerName: "Priyanka Silva",
                    items: [
                        { name: "Spicy Chicken Burger", quantity: 1 },
                        { name: "Onion Rings", quantity: 1 },
                        { name: "Chocolate Milkshake", quantity: 1 }
                    ],
                    totalPrice: 950
                },
                {
                    customerName: "Dinesh Kumar",
                    items: [
                        { name: "Double Beef Burger", quantity: 1 },
                        { name: "French Fries", quantity: 2 },
                        { name: "Iced Tea", quantity: 1 }
                    ],
                    totalPrice: 1100
                }
            ];

            processAndDisplayData(sampleOrders, "");
            initializeCharts();
        }

        function displayNoDataMessage() {
            const message = document.createElement('div');
            message.className = 'alert alert-info';
            message.textContent = 'No order data is available. Displaying sample data for demonstration.';

            const container = document.querySelector('.container');
            container.insertBefore(message, container.firstChild.nextSibling);
        }

        function processAndDisplayData(orders, todayString) {
            const customerOrderCount = {};
            const itemCount = {};
            const todayTransactions = [];

            orders.forEach(order => {
                console.log('Processing order:', order);

                const customerName = order.customerName || 'Unknown Customer';
                customerOrderCount[customerName] = (customerOrderCount[customerName] || 0) + 1;

                if (Array.isArray(order.items)) {
                    order.items.forEach(item => {
                        const itemName = item.name || 'Unknown Item';
                        const quantity = parseInt(item.quantity) || 0;
                        itemCount[itemName] = (itemCount[itemName] || 0) + quantity;
                    });
                }

                todayTransactions.push(order);
            });

            const sortedCustomers = Object.entries(customerOrderCount)
                .sort((a, b) => b[1] - a[1]);
            populateCustomerTable(sortedCustomers);

            const sortedItems = Object.entries(itemCount)
                .sort((a, b) => b[1] - a[1]);
            populateItemTable(sortedItems);

            populateTransactionTable(todayTransactions);
        }

        function populateTransactionTable(transactions) {
            const transactionTableBody = document.getElementById('transactionTable').getElementsByTagName('tbody')[0];
            transactionTableBody.innerHTML = '';

            if (transactions.length === 0) {
                const row = transactionTableBody.insertRow();
                const cell = row.insertCell();
                cell.colSpan = 3;
                cell.textContent = 'No transactions available';
                return;
            }

            transactions.forEach(order => {
                const row = transactionTableBody.insertRow();
                const items = Array.isArray(order.items)
                    ? order.items.map(item => `${item.name || 'Unknown Item'} (x${parseInt(item.quantity) || 0})`).join(', ')
                    : 'No items';

                const totalAmount = order.totalPrice || 0;

                row.innerHTML = `
                    <td>${order.customerName || 'Unknown Customer'}</td>
                    <td>${items}</td>
                    <td>Rs. ${(parseFloat(totalAmount)).toFixed(2)}</td>
                `;
            });
        }

        function populateCustomerTable(sortedCustomers) {
            const customerTableBody = document.getElementById('customerTable').getElementsByTagName('tbody')[0];
            customerTableBody.innerHTML = '';

            if (sortedCustomers.length === 0) {
                const row = customerTableBody.insertRow();
                const cell = row.insertCell();
                cell.colSpan = 2;
                cell.textContent = 'No customer data available';
                return;
            }

            sortedCustomers.forEach(([customerName, orderCount]) => {
                const row = customerTableBody.insertRow();
                row.innerHTML = `
                    <td>${customerName}</td>
                    <td>${orderCount}</td>
                `;
            });
        }

        function populateItemTable(sortedItems) {
            const itemTableBody = document.getElementById('itemTable').getElementsByTagName('tbody')[0];
            itemTableBody.innerHTML = '';

            if (sortedItems.length === 0) {
                const row = itemTableBody.insertRow();
                const cell = row.insertCell();
                cell.colSpan = 2;
                cell.textContent = 'No item data available';
                return;
            }

            sortedItems.forEach(([itemName, quantity]) => {
                const row = itemTableBody.insertRow();
                row.innerHTML = `
                    <td>${itemName}</td>
                    <td>${quantity}</td>
                `;
            });
        }

        function initializeCharts() {
            // Daily Sales Chart - Hourly distribution
            const dailySalesCtx = document.getElementById('dailySalesChart').getContext('2d');
            const dailySalesChart = new Chart(dailySalesCtx, {
                type: 'line',
                data: {
                    labels: ['8 AM', '9 AM', '10 AM', '11 AM', '12 PM', '1 PM', '2 PM', '3 PM', '4 PM', '5 PM', '6 PM', '7 PM', '8 PM', '9 PM'],
                    datasets: [{
                        label: 'Sales (Rs.)',
                        data: [1200, 1800, 2100, 4500, 6500, 5800, 3200, 2800, 3500, 4200, 5100, 4800, 3900, 2100],
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Sales (Rs.)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Hour of Day'
                            }
                        }
                    }
                }
            });

            // Daily Category Chart
            const dailyCategoryCtx = document.getElementById('dailyCategoryChart').getContext('2d');
            const dailyCategoryChart = new Chart(dailyCategoryCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Burgers', 'Sides', 'Beverages', 'Desserts'],
                    datasets: [{
                        data: [58, 22, 14, 6],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(75, 192, 192, 0.7)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // Monthly Sales Chart
            const monthlySalesCtx = document.getElementById('monthlySalesChart').getContext('2d');
            const monthlySalesChart = new Chart(monthlySalesCtx, {
                type: 'bar',
                data: {
                    labels: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15',
                        '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30'],
                    datasets: [{
                        label: 'Daily Sales (Rs.)',
                        data: [42500, 38900, 41200, 39800, 45300, 52100, 58400, 40200, 38600, 41500, 43200, 44500,
                            39800, 41300, 52100, 54300, 47800, 39200, 40100, 42300, 44500, 46200, 48900, 51200,
                            47500, 45300, 43200, 48900, 52300, 54800],
                        backgroundColor: 'rgba(54, 162, 235, 0.7)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Sales (Rs.)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Day of Month'
                            }
                        }
                    }
                }
            });

            // Top Items Chart
            const topItemsCtx = document.getElementById('topItemsChart').getContext('2d');
            const topItemsChart = new Chart(topItemsCtx, {
                type: 'bar',
                data: {
                    labels: ['Classic Cheeseburger', 'Spicy Chicken Burger', 'French Fries', 'Chocolate Milkshake', 'Double Beef Burger'],
                    datasets: [{
                        label: 'Units Sold',
                        data: [1245, 1028, 985, 874, 765],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(75, 192, 192, 0.7)',
                            'rgba(153, 102, 255, 0.7)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Annual Sales Chart
            const annualSalesCtx = document.getElementById('annualSalesChart').getContext('2d');
            const annualSalesChart = new Chart(annualSalesCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [{
                        label: 'Monthly Revenue (Rs.)',
                        data: [980500, 1050200, 1150400, 1245780, 1320500, 1420800, 1350400, 1290300, 1380600, 1420500, 1480900, 1560300],
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Revenue (Rs.)'
                            }
                        }
                    }
                }
            });

            // Quarterly Comparison Chart
            const quarterlyComparisonCtx = document.getElementById('quarterlyComparisonChart').getContext('2d');
            const quarterlyComparisonChart = new Chart(quarterlyComparisonCtx, {
                type: 'bar',
                data: {
                    labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                    datasets: [
                        {
                            label: 'Revenue (Rs.)',
                            data: [3181100, 3987080, 4021300, 4461700],
                            backgroundColor: 'rgba(54, 162, 235, 0.7)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Orders',
                            data: [6450, 7920, 7250, 8125],
                            type: 'line',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 2,
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Revenue (Rs.)'
                            },
                            position: 'left'
                        },
                        y1: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Order Count'
                            },
                            position: 'right',
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });

            // Category Sales Chart
            const categorySalesCtx = document.getElementById('categorySalesChart').getContext('2d');
            const categorySalesChart = new Chart(categorySalesCtx, {
                type: 'pie',
                data: {
                    labels: ['Burgers', 'Sides', 'Beverages', 'Desserts'],
                    datasets: [{
                        data: [8450500, 2560800, 2120400, 1437220],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(75, 192, 192, 0.7)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // Category Distribution Chart
            const categoryDistributionCtx = document.getElementById('categoryDistributionChart').getContext('2d');
            const categoryDistributionChart = new Chart(categoryDistributionCtx, {
                type: 'pie',
                data: {
                    labels: ['Burgers', 'Sides', 'Beverages', 'Desserts'],
                    datasets: [{
                        data: [58, 22, 14, 6],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(75, 192, 192, 0.7)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Sales by Category (%)'
                        }
                    }
                }
            });

            // Item Trend Chart
            const itemTrendCtx = document.getElementById('itemTrendChart').getContext('2d');
            const itemTrendChart = new Chart(itemTrendCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [
                        {
                            label: 'Classic Cheeseburger',
                            data: [980, 1050, 1080, 1150, 1180, 1220, 1180, 1150, 1180, 1240, 1280, 1320],
                            borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(255, 99, 132, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'Spicy Chicken Burger',
                            data: [820, 880, 920, 980, 1020, 1080, 1040, 990, 1030, 1080, 1120, 1180],
                            borderColor: 'rgba(54, 162, 235, 1)',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'French Fries',
                            data: [780, 820, 860, 900, 940, 980, 950, 920, 950, 990, 1030, 1080],
                            borderColor: 'rgba(255, 206, 86, 1)',
                            backgroundColor: 'rgba(255, 206, 86, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'Chocolate Milkshake',
                            data: [650, 680, 710, 750, 820, 850, 890, 860, 820, 790, 760, 730],
                            borderColor: 'rgba(75, 192, 192, 1)',
                            backgroundColor: 'rgba(75, 192, 192, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'Double Beef Burger',
                            data: [580, 620, 650, 690, 720, 760, 740, 720, 750, 780, 810, 850],
                            borderColor: 'rgba(153, 102, 255, 1)',
                            backgroundColor: 'rgba(153, 102, 255, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Monthly Sales Trend by Item'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Units Sold'
                            }
                        }
                    }
                }
            });
        }

        function generatePDFReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'landscape',
                unit: 'mm',
                format: 'a4'
            });

            const pageWidth = doc.internal.pageSize.width;
            const pageHeight = doc.internal.pageSize.height;

            function addHeader() {
                doc.setFontSize(18);
                doc.setTextColor(0, 0, 0);
                doc.text("MOS BURGERS", pageWidth / 2, 10, { align: 'center' });
                doc.setFontSize(14);
                doc.setTextColor(0, 0, 0)
                doc.text("Daily Order Report", pageWidth / 2, 20, { align: 'center' });
                doc.setFontSize(10);
                doc.text(`Report generated on: ${new Date().toLocaleString()}`, pageWidth / 2, 25, { align: 'center' });
            }

            function addFooter(pageNumber) {
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.text("Burger Shop - Tasty burgers, happy customers!", pageWidth / 2, pageHeight - 10, { align: 'center' });
                doc.text(`Page ${pageNumber}`, pageWidth - 10, pageHeight - 10, { align: 'right' });
                doc.text("www.burgershop.lk", 10, pageHeight - 10);
            }


            let yPos = 35;
            let pageNumber = 1;

            addHeader();
            addFooter(pageNumber);

            function addTableToPDF(title, tableId, columns) {
                if (yPos > pageHeight - 40) {
                    doc.addPage();
                    pageNumber++;
                    yPos = 35;
                    addHeader();
                    addFooter(pageNumber);
                }

                doc.setFontSize(14);
                doc.setTextColor(0, 0, 0);
                doc.text(title, 14, yPos);
                yPos += 10;

                const table = document.getElementById(tableId);
                const data = [];

                const headers = Array.from(table.querySelectorAll('th')).map(th => th.textContent);

                Array.from(table.querySelectorAll('tbody tr')).forEach(row => {
                    const rowData = Array.from(row.querySelectorAll('td')).map(td => td.textContent);
                    data.push(rowData);
                });

                doc.autoTable({
                    head: [headers],
                    body: data,
                    startY: yPos,
                    theme: 'grid',
                    styles: { fontSize: 8, cellPadding: 2 },
                    headStyles: { fillColor: [0, 0, 0], textColor: [255, 255, 255] },
                    columnStyles: columns,
                    margin: { top: 30, left: 10, right: 10, bottom: 20 },
                    tableWidth: 'auto',
                    didDrawPage: function (data) {
                        addHeader();
                        addFooter(pageNumber);
                    }
                });

                yPos = doc.lastAutoTable.finalY + 20;
            }

            addTableToPDF("Customers with Most Orders", "customerTable", {
                0: { cellWidth: 'auto' },
                1: { cellWidth: 'auto' }
            });

            if (yPos > pageHeight - 40) {
                doc.addPage();
                pageNumber++;
                yPos = 35;
                addHeader();
                addFooter(pageNumber);
            }

            addTableToPDF("Most Popular Items for the Day", "itemTable", {
                0: { cellWidth: 'auto' },
                1: { cellWidth: 'auto' }
            });

            if (yPos > pageHeight - 40) {
                doc.addPage();
                pageNumber++;
                yPos = 35;
                addHeader();
                addFooter(pageNumber);
            }

            addTableToPDF("Transaction History for Today", "transactionTable", {
                0: { cellWidth: 'auto' },
                1: { cellWidth: 'auto' },
                2: { cellWidth: 'auto' }
            });

            doc.save("MOS_BURGERS_DailyOrderReport.pdf");
        }

        document.getElementById('generatePDFButton').addEventListener('click', generatePDFReport);

        // Filter functionality
        document.getElementById('applyFilters').addEventListener('click', function () {
            alert('Filters applied. Report data updated.');
            // In a real implementation, this would re-fetch data based on filters
        });

        document.getElementById('resetFilters').addEventListener('click', function () {
            document.getElementById('dateRange').value = 'today';
            document.getElementById('categoryFilter').value = 'all';
            document.getElementById('locationFilter').value = 'all';
            alert('Filters have been reset.');
        });
    </script>
</body>

</html>